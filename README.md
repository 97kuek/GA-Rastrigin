# 遺伝的アルゴリズムによるRastrigin関数の最適化

## 1. 概要

本プログラムは**遺伝的アルゴリズム（Genetic Algorithm; GA）**を用いて、多峰性関数である**Rastrigin関数**の最小値を探索する。
Rastrigin関数は多数の局所解を持つため、単純な勾配法では最適解にたどり着きにくく、最適化アルゴリズムの性能検証によく用いられる。
本プログラムでは、**交叉（SBX: Simulated Binary Crossover）**、**多項式突然変異（Polynomial Mutation）**、**トーナメント選択**などの標準的なGA手法を組み込み、さらに**リアルタイム可視化**に対応している。

---

## 2. Rastrigin関数

![Rastrigin関数](./assets/rastrigin.png)

Rastrigin関数は次式で定義される。

$$
f(\mathbf{x}) = A \cdot n + \sum_{i=1}^{n} \left[ x_i^2 - A \cos( 2\pi x_i) \right]
$$

* $n$ : 次元数
* $A = 10$（一般的な定数）
* 定義域 : $[-5.12, 5.12]^n$
* 大域的最小値 : $f(\mathbf{0}) = 0$

---

## 3. 理論：遺伝的アルゴリズムの原理

### 3.1 基本概念

遺伝的アルゴリズム（GA）は、生物の進化を模した確率的探索アルゴリズムである。
**自然選択**と**遺伝的変異**の過程を数値計算に適用することで、多峰性の探索空間でも有効に最適解を探索できる。

基本ステップは以下です。

1. **初期化** — ランダムに集団（複数の解）を生成
2. **評価** — 各解の適応度を計算
3. **選択** — 優れた解を次世代に残す
4. **交叉** — 親の情報を組み合わせて子を生成
5. **突然変異** — 解の一部をランダムに変更して多様性を維持
6. **終了判定** — 最大世代数や収束条件で終了

---

### 3.2 本プログラムで採用している手法

#### (1) 選択 — **トーナメント選択**

* 集団からランダムに$k$個体を選び、その中で最良の個体を親に選出。
* 適応度の良い個体が選ばれやすく、パラメータ$k$で選択圧を調整可能。

#### (2) 交叉 — **Simulated Binary Crossover (SBX)**

実数値GAで広く用いられる交叉手法で、親の間に仮想的な二項分布をシミュレートして子を生成する。

親 $p_1, p_2$ の $i$ 番目の遺伝子を $x_1, x_2$ とすると、子は次の式で生成される。

$$
\beta_q =
\begin{cases}
(r \cdot \alpha)^{1/(\eta_c + 1)}, & \text{if } r \le \frac{1}{\alpha} \\
\left(\frac{1}{2 - r \cdot \alpha}\right)^{1/(\eta_c + 1)}, & \text{otherwise}
\end{cases}
$$

ただし、

$$
\beta = 1 + \frac{2(x_1 - L)}{x_2 - x_1}, \quad
\alpha = 2 - \beta^{-(\eta_c + 1)}
$$

$\eta_c$ は**分布指数**で、大きいほど親に近い子が生まれやすい。

子個体は次のように計算される。

$$
c_1 = 0.5 \left[ (x_1 + x_2) - \beta_q (x_2 - x_1) \right]
$$

$$
c_2 = 0.5 \left[ (x_1 + x_2) + \beta_q (x_2 - x_1) \right]
$$

---

#### (3) 突然変異 — **Polynomial Mutation**

個体の各遺伝子 $x$ に対して、確率 $p_m$ で次の変化を適用する。

まず、

$$
\delta_1 = \frac{x - L}{U - L}, \quad
\delta_2 = \frac{U - x}{U - L}
$$

を計算する（$L, U$ は下限・上限）。

乱数 $r \in [0,1]$ を生成し、次式で変異量 $\delta_q$ を求める。

* **場合1**（左側に変異）：

$$
xy = 1 - \delta_1
$$

$$
\delta_q = (2r + (1 - 2r) \cdot xy^{\eta_m + 1})^{1/(\eta_m + 1)} - 1
$$

* **場合2**（右側に変異）：

$$
xy = 1 - \delta_2
$$

$$
\delta_q = 1 - \left[ 2(1-r) + 2(r - 0.5) \cdot xy^{\eta_m + 1} \right]^{1/(\eta_m + 1)}
$$

最終的に、

$$
x' = x + \delta_q \cdot (U - L)
$$

として変異後の値を得る。
$\eta_m$（pm\_eta）が大きいほど変異幅は小さくなる。

---

#### (4) エリート保存

* 各世代の最良個体を必ず次世代にコピー。
* 解の品質の劣化を防ぐ。

#### (5) 早期終了（収束判定）

* 一定世代（stagnation\_patience）改善が見られなければ終了。

---

### 3.3 GAの長所と短所

**長所**

* 多峰性関数や離散・連続混合問題にも適用可能
* 勾配情報不要（非微分可能関数OK）
* 並列化しやすい

**短所**

* 勾配法より収束が遅い場合あり
* パラメータ調整（集団サイズ、交叉率、突然変異率など）が必要

---

## 4. プログラム構成

### 4.1 評価関数 `rastrigin`

与えられた個体（解ベクトル）のRastrigin関数値を計算。

### 4.2 設定クラス `GAConfig`

GAの動作パラメータ（集団サイズ、交叉率、突然変異率、最大世代数、可視化設定など）を一元管理。

### 4.3 履歴クラス `GAHistory`

各世代の統計情報（最良値、平均値、中央値、最悪値、標準偏差）や最良個体の履歴を保持。

### 4.4 GA操作関数

* **初期化**

  * `init_individual` : 個体の生成
  * `init_population` : 初期集団の生成
* **評価**

  * `evaluate_population` : 個体の適応度（評価関数値）を計算
* **選択**

  * `tournament_select` : トーナメント方式による親個体選択
* **交叉**

  * `sbx_crossover` : シミュレーテッド・バイナリー交叉（SBX）
* **突然変異**

  * `polynomial_mutation` : 多項式突然変異

### 4.5 可視化クラス `RealtimeViz`

収束曲線や（2次元時のみ）探索空間上での個体の分布をリアルタイム表示。

### 4.6 進化ループ `run_ga`

初期化 → 評価 → 選択 → 交叉 → 突然変異 → 評価 → 世代更新 を繰り返し、最良解が更新されるたびに履歴・可視化を更新。

---

## 5. 実行方法

### 必要環境

* Python 3.8以上
* 必須ライブラリ

  ```bash
  pip install numpy matplotlib
  ```

### 実行例

```bash
python ga_rastrigin.py
```

---

## 6. 主な設定項目（GAConfig）

| パラメータ                         | 説明                   | デフォルト値       |
| ----------------------------- | -------------------- | ------------ |
| `dim`                         | 次元数                  | 2            |
| `lower_bound` / `upper_bound` | 探索範囲の下限・上限           | -5.12 / 5.12 |
| `pop_size`                    | 集団サイズ                | 120          |
| `max_generations`             | 最大世代数                | 300          |
| `elite_ratio`                 | エリート選択割合             | 0.02         |
| `tournament_k`                | トーナメント選択の参加個体数       | 3            |
| `crossover_rate`              | 交叉率                  | 0.9          |
| `mutation_rate`               | 突然変異率                | 1.0/dim      |
| `sbx_eta`                     | SBX交叉の分布指数           | 20.0         |
| `pm_eta`                      | 多項式突然変異の分布指数         | 20.0         |
| `stagnation_patience`         | 改善が見られない場合の早期終了猶予世代数 | 80           |
| `realtime`                    | リアルタイム可視化ON/OFF      | True         |

---